version: '3.9'

services:
  envoy:
    image: higress-registry.cn-hangzhou.cr.aliyuncs.com/higress/all-in-one:1.3.6
    entrypoint: /usr/local/bin/envoy
    command: -c /etc/envoy/envoy.yaml --component-log-level wasm:debug
    networks:
    - wasmtest
    ports:
    - "8080:8080/tcp"
    - "8001:8001/tcp"
    volumes:
    - ./envoy.yaml:/etc/envoy/envoy.yaml
    - ./plugin.wasm:/etc/envoy/plugin.wasm

  nextchat:
    image: yidadaa/chatgpt-next-web
    environment:
      - CODE=20020806
      - OPENAI_API_KEY=unused
      - CUSTOM_MODELS=-all,+gpt-4o
      - BASE_URL=http://higress:8080
    networks:
      - wasmtest
    ports:
      - "3000:3000/tcp"
    restart: always

networks:
  wasmtest:
    external: false